<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="1071px" height="611px" viewBox="-0.5 -0.5 1071 611" content="&lt;mxfile&gt;&lt;diagram id=&quot;W8thJxA2v2r9GThXU8aW&quot; name=&quot;Page-1&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;"><defs/><g><rect x="0" y="0" width="880" height="510" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><rect x="40" y="590" width="270" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 600px; margin-left: 175px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: nowrap;">ユースケースを素直に表現できるように実装する。</div></div></div></foreignObject><text x="175" y="603" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="11px" text-anchor="middle">ユースケースを素直に表現できるように実装する。</text></switch></g><path d="M 160 80 L 160 93.63" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 160 98.88 L 156.5 91.88 L 160 93.63 L 163.5 91.88 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="140" y="60" width="40" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 70px; margin-left: 160px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: nowrap;">Start</div></div></div></foreignObject><text x="160" y="74" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">Start</text></switch></g><path d="M 160 140 L 160 163.63" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 160 168.88 L 156.5 161.88 L 160 163.63 L 163.5 161.88 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="100" y="100" width="120" height="40" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 120px; margin-left: 101px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">デフォルトの支払い方法の取得</div></div></div></foreignObject><text x="160" y="124" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">デフォルトの支払い方法の取得</text></switch></g><rect x="40" y="0" width="220" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 10px; margin-left: 150px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: nowrap;">ストライプで取引開始のユースケース</div></div></div></foreignObject><text x="150" y="14" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">ストライプで取引開始のユースケース</text></switch></g><path d="M 160 210 L 160 233.63" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 160 238.88 L 156.5 231.88 L 160 233.63 L 163.5 231.88 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="100" y="170" width="120" height="40" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 190px; margin-left: 101px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">ストライプでの支払い取引の追跡の初期化</div></div></div></foreignObject><text x="160" y="194" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">ストライプでの支払い取引の追跡の初期化</text></switch></g><path d="M 160 340 L 160 363.63" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 160 368.88 L 156.5 361.88 L 160 363.63 L 163.5 361.88 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="100" y="300" width="120" height="40" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 320px; margin-left: 101px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">ストライプの取引状態を自分のデータベースに保存</div></div></div></foreignObject><text x="160" y="324" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">ストライプの取引状態を自分のデータベースに保存</text></switch></g><path d="M 160 280 L 160 293.63" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 160 298.88 L 156.5 291.88 L 160 293.63 L 163.5 291.88 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 220 254.96 L 256.91 251.85" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 262.15 251.41 L 255.46 255.49 L 256.91 251.85 L 254.88 248.51 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="100" y="240" width="120" height="40" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 260px; margin-left: 101px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">取引オブジェクトを作成</div></div></div></foreignObject><text x="160" y="264" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">取引オブジェクトを作成</text></switch></g><rect x="100" y="370" width="120" height="40" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 390px; margin-left: 101px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">取引状態を自分のデータベースに保存</div></div></div></foreignObject><text x="160" y="394" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">取引状態を自分のデータベースに保存</text></switch></g><rect x="440" y="50" width="630" height="440" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 1px; height: 1px; padding-top: 270px; margin-left: 442px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: nowrap;"><div><span>@Injectable()</span><br /></div><div>export class CreateCommandHandler {</div><div>  async execute(command: CreateDealCommand): Promise&lt;DealResponseDto&gt; {</div><div>    const ticket = await this.ticketRepo.findDefaultPaymentCard(command.ticketId)</div><div><br /></div><div>    const stripePayment = await this.stripePaymentRepo.findCurrentByUserId(command.customerId)</div><div><br /></div><div>    const stripePaymentIntent = await this.stripeService.createStripePaymentIntent(stripePayment, ticket.totalPrice())</div><div><br /></div><div>    const deal = DealEntity.create({</div><div>      ticketId: command.ticketId,</div><div>      customerId: command.customerId,</div><div>    })</div><div><br /></div><div>    const stripeInvoice = StripeInvoiceEntity.create({</div><div>      dealId: deal.id,</div><div>      userId: command.customerId,</div><div>      stripePaymentId: stripePayment.id,</div><div>      amount: stripePaymentIntent.amount,</div><div>      stripePaymentIntentId: stripePaymentIntent.id,</div><div>    })</div><div><br /></div><div>    await this.prisma.$transaction(async (tx: Prisma.TransactionClient) =&gt; {</div><div>      await this.dealRepo.insert(tx, deal)</div><div>      await this.stripeInvoiceRepo.insert(tx, stripeInvoice)</div><div>    })</div><div><br /></div><div>    return this.dealMapper.toResponse(deal)</div><div>  }</div><div>}</div><div><br /></div></div></div></div></foreignObject><text x="442" y="274" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px">@Injectable()...</text></switch></g><rect x="20" y="20" width="420" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 30px; margin-left: 230px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: nowrap;">変に抽象化することなく、素直に処理フロー（仕様を）実現することが重要</div></div></div></foreignObject><text x="230" y="34" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">変に抽象化することなく、素直に処理フロー（仕様を）実現することが重要</text></switch></g><path d="M 430 243.55 L 433.65 243.84" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 438.89 244.27 L 431.62 247.19 L 433.65 243.84 L 432.19 240.21 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="220" y="220" width="210" height="30" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 235px; margin-left: 325px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: nowrap;">主な処理を抽象化せずに<br />コードと1:1くらいになるように対応</div></div></div></foreignObject><text x="325" y="239" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">主な処理を抽象化せずに
コードと1:1くらいになるように対応</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://www.diagrams.net/doc/faq/svg-export-text-problems" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Viewer does not support full SVG 1.1</text></a></switch></svg>